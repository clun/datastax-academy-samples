CREATE KEYSPACE ckm_t_pilot WITH replication = {
  'class': 'SimpleStrategy', 
  'replication_factor': '3'} AND durable_writes = true;

CREATE TYPE ckm_t_pilot.address (
    street_no text,
    street_no_cplmt text,
    street_name text,
    postal_code text,
    city_name text,
    dpt_name text,
    country text
);

CREATE TYPE ckm_t_pilot.cluster_detail (
    src_sys_name text,
    src_customer_uid text,
    confidence_level double
);

CREATE TABLE ckm_t_pilot.golden_clusters_by_customer (
    cluster_id text,
    src_country_code text,
    user_id text,
    src_customer_id text,
    cd_si_ext text,
    cluster_size int,
    company_name text,
    company_reg_no text,
    confidence_level double,
    customer_address frozen<address>,
    customer_name text,
    customer_type text,
    customer_type_id int,
    deceased text,
    display_name text,
    dob date,
    email text,
    employer_address frozen<address>,
    employer_house_name text,
    employer_name text,
    employment_start_date date,
    established_date date,
    firstname text,
    gender text,
    golden_address map<text, frozen<address>>,
    golden_cd_si_ext text,
    golden_company_name text,
    golden_company_reg_no text,
    golden_customer_name text,
    golden_customer_type text,
    golden_customer_type_id int,
    golden_deceased text,
    golden_display_name text,
    golden_dob date,
    golden_email map<text, text>,
    golden_employer_address frozen<address>,
    golden_employer_house_name text,
    golden_employer_name text,
    golden_employment_start_date date,
    golden_established_date date,
    golden_firstname text,
    golden_gender text,
    golden_gross_annual_salary decimal,
    golden_insolvency_status text,
    golden_job_title text,
    golden_marital_status text,
    golden_mobile map<text, text>,
    golden_no_contact_requested text,
    golden_occupation text,
    golden_paperless text,
    golden_surname text,
    golden_telephone map<text, text>,
    golden_title text,
    golden_type_of_insolvency text,
    gross_annual_salary decimal,
    insolvency_status text,
    is_merged boolean,
    job_title text,
    marital_status text,
    mobile text,
    no_cli_crm text,
    no_contact_requested text,
    occupation text,
    paperless text,
    solr_query text,
    src_customer_uid text,
    src_sys_name text,
    surname text,
    telephone text,
    title text,
    type_of_insolvency text,
    update_time timestamp,
    PRIMARY KEY (cluster_id, src_country_code, user_id, src_customer_id)
) WITH CLUSTERING ORDER BY (src_country_code ASC, user_id ASC, src_customer_id ASC);

CREATE CUSTOM INDEX ckm_t_pilot_golden_clusters_by_customer_solr_query_index ON ckm_t_pilot.golden_clusters_by_customer (solr_query) USING 'com.datastax.bdp.search.solr.Cql3SolrSecondaryIndex';

CREATE TABLE ckm_t_pilot.clusters_by_customer (
    src_customer_id text,
    src_country_code text,
    cd_si_ext text,
    cluster_id text,
    cluster_size int,
    cluster_status text,
    company_name text,
    company_reg_no text,
    confidence_level double,
    current_dedup_cluster_id text,
    current_golden_cluster_id text,
    customer_address frozen<address>,
    customer_name text,
    customer_type text,
    customer_type_id int,
    deceased text,
    display_name text,
    dob date,
    email text,
    employer_address frozen<address>,
    employer_house_name text,
    employer_name text,
    employment_start_date date,
    established_date date,
    firstname text,
    gender text,
    gross_annual_salary decimal,
    insolvency_status text,
    is_merged boolean,
    job_title text,
    marital_status text,
    mobile text,
    no_cli_crm text,
    no_contact_requested text,
    occupation text,
    paperless text,
    solr_query text,
    src_customer_uid text,
    src_sys_name text,
    surname text,
    telephone text,
    title text,
    type_of_insolvency text,
    update_time timestamp,
    PRIMARY KEY (src_customer_id, src_country_code)
) WITH CLUSTERING ORDER BY (src_country_code ASC);
CREATE CUSTOM INDEX ckm_t_pilot_clusters_by_customer_solr_query_index ON ckm_t_pilot.clusters_by_customer (solr_query) USING 'com.datastax.bdp.search.solr.Cql3SolrSecondaryIndex';

CREATE TABLE ckm_t_pilot.contracts_by_status (
    src_customer_id text,
    agreement_id text,
    src_country_code text,
    activated_by text,
    activated_date date,
    activation_requested_by text,
    activation_requested_date date,
    advance_payment decimal,
    advance_payment_ex_vat decimal,
    agreement_start_date date,
    alfa_agreement_no text,
    amount_financed decimal,
    amount_outstanding decimal,
    amount_outstanding_ex_vat decimal,
    amount_paid decimal,
    approved_date date,
    apr decimal,
    arrears decimal,
    balloon decimal,
    balloon_ex_vat decimal,
    base_rate decimal,
    bin_number text,
    birthday date,
    cap_clean decimal,
    cap_id_exchange text,
    capital_due decimal,
    capital_total decimal,
    cash_deposit decimal,
    catalogue_price decimal,
    company_address frozen<address>,
    company_name text,
    company_reg_no text,
    contra_contract_id text,
    contract_type text,
    current_accounting_status text,
    customer_firstname text,
    customer_id text,
    customer_rate decimal,
    customer_surname text,
    customer_title text,
    customer_type text,
    customer_type_id int,
    customer_vehicle_price decimal,
    customer_vehicle_price_ex_vat decimal,
    days_late int,
    dealer_commission decimal,
    dealer_fit_options_total decimal,
    dealer_id text,
    dealer_promise text,
    dealer_subsidy decimal,
    dealer_subsidy_ex_vat decimal,
    deceased text,
    deposit_contribution decimal,
    dob date,
    doc_fee decimal,
    email_address text,
    employer_address frozen<address>,
    employer_house_name text,
    employer_name text,
    employment_start_date date,
    established_date date,
    estimated_current_mileage int,
    exposure_at_acceptance decimal,
    factory_fit_options_total decimal,
    fax_no text,
    finance_amount_ex_vat decimal,
    finance_brand text,
    finance_commission decimal,
    finance_facility_fee decimal,
    finance_facility_fee_ex_vat decimal,
    finance_review text,
    flags text,
    gender text,
    gross_annual_salary decimal,
    has_active_agreements text,
    has_services boolean,
    initial_rv_ht decimal,
    insolvency_status text,
    interest_due decimal,
    interest_total decimal,
    interest_total_ex_vat decimal,
    invoice_validated_date date,
    is_frozen boolean,
    is_reapproval_option text,
    job_title text,
    kai_ku_amount decimal,
    manufacturer_subsidy decimal,
    marital_status text,
    maturity_date date,
    mileage_per_year int,
    mobile_no text,
    monthly_payment decimal,
    net_book_value decimal,
    new_used boolean,
    no_cnt_crm text,
    no_cnt_ext text,
    no_contact_requested text,
    number_of_advanced_payments int,
    number_of_rentals_paid int,
    occupation text,
    option_to_purchase_fee decimal,
    original_registration_no text,
    other_charges decimal,
    other_charges_ex_vat decimal,
    otp_ex_vat decimal,
    pancode2 text,
    paperless boolean,
    part_exchange decimal,
    payment_method text,
    payout_sqc int,
    portal_status text,
    predicted_residual_value decimal,
    predicted_residual_value_ex_vat decimal,
    product_id text,
    proposal_created_date date,
    rci_subsidy decimal,
    referred_date date,
    registration_date date,
    registration_letter text,
    registration_no text,
    registration_no_exchange text,
    registration_year int,
    remaining_term int,
    residual_value decimal,
    residual_value_ex_vat decimal,
    scorecard_id int,
    scoregrade int,
    secondary_rental text,
    services decimal,
    services_ex_vat decimal,
    settlement_amount decimal,
    settlement_type text,
    settlement_type_id int,
    sold_date date,
    sold_price decimal,
    solr_query text,
    sqc int,
    src_sys_name text,
    start_mileage int,
    status_id text,
    submitted_by text,
    submitted_date date,
    sys_apl text,
    telephone_no text,
    term int,
    terminated_date date,
    termination_reason text,
    termination_reason_id int,
    total_charges decimal,
    total_charges_ex_vat decimal,
    total_deposit decimal,
    total_deposit_ex_vat decimal,
    total_mileage int,
    total_payable_inc_deposit decimal,
    total_payable_inc_deposit_ex_vat decimal,
    total_rentals decimal,
    total_rentals_ex_vat decimal,
    true_balance decimal,
    true_rate decimal,
    type_of_insolvency text,
    underwritten_by text,
    underwritten_date date,
    underwritten_score int,
    underwritten_start_date date,
    underwritten_started_by text,
    update_time timestamp,
    vat_code text,
    vb_counts text,
    vb_pays text,
    vehicle_age text,
    vehicle_age_months int,
    vehicle_fund_license decimal,
    vehicle_id text,
    vehicle_id_exchange text,
    vehicle_price_total decimal,
    vin_no text,
    volume_related_bonus_amount decimal,
    withdrawal_reason text,
    wrong_doc_by text,
    wrong_doc_date date,
    PRIMARY KEY (src_customer_id, agreement_id, src_country_code)
) WITH CLUSTERING ORDER BY (agreement_id ASC, src_country_code ASC);

CREATE CUSTOM INDEX ckm_t_pilot_contracts_by_status_solr_query_index ON ckm_t_pilot.contracts_by_status (solr_query) USING 'com.datastax.bdp.search.solr.Cql3SolrSecondaryIndex';
